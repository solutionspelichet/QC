<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QC Mobile</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="style.css">
  <meta name="theme-color" content="#ff6a00">
  <script defer src="https://unpkg.com/@zxing/library@0.20.0/umd/index.min.js"></script>
  <script defer src="app.js"></script>
</head>
<body class="dark">
  <header>
    <h1>QC Mobile</h1>
    <button id="toggleTheme" aria-label="Mode sombre/clair">üåì</button>
  </header>

  <main>
    <nav class="tabs">
      <button data-tab="cartons" class="active">Cartons</button>
      <button data-tab="palettes_avant">Palettes ‚Äî Avant camion</button>
      <button data-tab="palettes_dest">Palettes ‚Äî Destination</button>
      <button data-tab="kpi">KPI</button>
      <button data-tab="export">Export</button>
      <button id="btnProvision" class="outline">Provision (1√®re fois)</button>
    </nav>

    <!-- Cartons -->
    <section id="tab-cartons" class="tab active">
      <form id="formCartons" class="qc-form" enctype="multipart/form-data">
        <input type="hidden" name="route" value="qc">
        <input type="hidden" name="type" value="Cartons">

        <label>Date du jour
          <input type="date" name="date_jour" required />
        </label>

        <div class="group">
          <label>Scanner le code-barres (photo)
            <input type="file" id="cartonsScan" accept="image/*;capture=camera" />
          </label>
          <div class="row">
            <input type="text" name="code_barres" id="cartonsCode" inputmode="numeric" pattern="\\d*" placeholder="Code-barres" required />
            <button type="button" class="btn" id="btnDecodeCartons">D√©coder</button>
          </div>
        </div>

        <label>Photo principale du carton
          <input type="file" name="photo_principale" accept="image/*;capture=camera" required />
        </label>

        <fieldset>
          <legend>Contr√¥les</legend>

          <div class="q">
            <span>1. Callage papier bien fait ?</span>
            <div class="row">
              <label><input type="radio" name="q1_callage_ok" value="OK" checked> OK</label>
              <label><input type="radio" name="q1_callage_ok" value="KO"> Pas OK</label>
            </div>
            <div class="ko-fields" data-ko="q1_callage_ok">
              <label>Photo probl√®me <input type="file" name="q1_callage_ko_photo" accept="image/*;capture=camera"></label>
              <label>Commentaire <textarea name="q1_callage_ko_commentaire" rows="2"></textarea></label>
            </div>
          </div>

          <div class="q">
            <span>2. Intercalaires pour s√©parer les colonnes de livres ?</span>
            <div class="row">
              <label><input type="radio" name="q2_intercalaires_colonnes_ok" value="OK" checked> OK</label>
              <label><input type="radio" name="q2_intercalaires_colonnes_ok" value="KO"> Pas OK</label>
            </div>
            <div class="ko-fields" data-ko="q2_intercalaires_colonnes_ok">
              <label>Photo probl√®me <input type="file" name="q2_intercalaires_colonnes_ko_photo" accept="image/*;capture=camera"></label>
              <label>Commentaire <textarea name="q2_intercalaires_colonnes_ko_commentaire" rows="2"></textarea></label>
            </div>
          </div>

          <div class="q">
            <span>3. Ordre & disposition respect√©s ?</span>
            <div class="row">
              <label><input type="radio" name="q3_ordre_disposition_ok" value="OK" checked> OK</label>
              <label><input type="radio" name="q3_ordre_disposition_ok" value="KO"> Pas OK</label>
            </div>
            <div class="ko-fields" data-ko="q3_ordre_disposition_ok">
              <label>Photo probl√®me <input type="file" name="q3_ordre_disposition_ko_photo" accept="image/*;capture=camera"></label>
              <label>Commentaire <textarea name="q3_ordre_disposition_ko_commentaire" rows="2"></textarea></label>
            </div>
          </div>

          <div class="q">
            <span>4. Scotch bien appliqu√© ?</span>
            <div class="row">
              <label><input type="radio" name="q4_scotch_ok" value="OK" checked> OK</label>
              <label><input type="radio" name="q4_scotch_ok" value="KO"> Pas OK</label>
            </div>
            <div class="ko-fields" data-ko="q4_scotch_ok">
              <label>Photo probl√®me <input type="file" name="q4_scotch_ko_photo" accept="image/*;capture=camera"></label>
              <label>Commentaire <textarea name="q4_scotch_ko_commentaire" rows="2"></textarea></label>
            </div>
          </div>

          <div class="q">
            <span>5. Livres d√©poussi√©r√©s ?</span>
            <div class="row">
              <label><input type="radio" name="q5_depoussierage_ok" value="OK" checked> OK</label>
              <label><input type="radio" name="q5_depoussierage_ok" value="KO"> Pas OK</label>
            </div>
            <div class="ko-fields" data-ko="q5_depoussierage_ok">
              <label>Photo probl√®me <input type="file" name="q5_depoussierage_ko_photo" accept="image/*;capture=camera"></label>
              <label>Commentaire <textarea name="q5_depoussierage_ko_commentaire" rows="2"></textarea></label>
            </div>
          </div>
        </fieldset>

        <button class="primary" type="submit">Enregistrer</button>
        <p class="hint">Rappel : si vous mettez ‚ÄúPas OK‚Äù, une photo + un commentaire sont obligatoires.</p>
        <div class="toast" id="toastCartons"></div>
      </form>
    </section>

    <!-- Palettes Avant -->
    <section id="tab-palettes_avant" class="tab">
      <form id="formPaAvant" class="qc-form" enctype="multipart/form-data">
        <input type="hidden" name="route" value="qc">
        <input type="hidden" name="type" value="Palettes_Avant">

        <label>Date du jour <input type="date" name="date_jour" required /></label>

        <div class="group">
          <label>Scanner le code-barres palette (photo)
            <input type="file" id="paAvScan" accept="image/*;capture=camera" />
          </label>
          <div class="row">
            <input type="text" name="code_barres" id="paAvCode" inputmode="numeric" pattern="\\d*" placeholder="Code-barres palette" required />
            <button type="button" class="btn" id="btnDecodePaAv">D√©coder</button>
          </div>
        </div>

        <label>Photo principale de la palette
          <input type="file" name="photo_principale" accept="image/*;capture=camera" required />
        </label>

        <fieldset>
          <legend>Contr√¥les</legend>

          <div class="q">
            <span>1. Cartons en bon √©tat ?</span>
            <div class="row">
              <label><input type="radio" name="q1_etat_ok" value="OK" checked> OK</label>
              <label><input type="radio" name="q1_etat_ok" value="KO"> Pas OK</label>
            </div>
            <div class="ko-fields" data-ko="q1_etat_ok">
              <label>Photo probl√®me <input type="file" name="q1_etat_ko_photo" accept="image/*;capture=camera"></label>
              <label>Commentaire <textarea name="q1_etat_ko_commentaire" rows="2"></textarea></label>
            </div>
          </div>

          <div class="q">
            <span>2. Intercalaires pour s√©parer les cartons ?</span>
            <div class="row">
              <label><input type="radio" name="q2_intercalaires_ok" value="OK" checked> OK</label>
              <label><input type="radio" name="q2_intercalaires_ok" value="KO"> Pas OK</label>
            </div>
            <div class="ko-fields" data-ko="q2_intercalaires_ok">
              <label>Photo probl√®me <input type="file" name="q2_intercalaires_ko_photo" accept="image/*;capture=camera"></label>
              <label>Commentaire <textarea name="q2_intercalaires_ko_commentaire" rows="2"></textarea></label>
            </div>
          </div>

          <div class="q">
            <span>3. Ordre & disposition respect√©s ?</span>
            <div class="row">
              <label><input type="radio" name="q3_ordre_disposition_ok" value="OK" checked> OK</label>
              <label><input type="radio" name="q3_ordre_disposition_ok" value="KO"> Pas OK</label>
            </div>
            <div class="ko-fields" data-ko="q3_ordre_disposition_ok">
              <label>Photo probl√®me <input type="file" name="q3_ordre_disposition_ko_photo" accept="image/*;capture=camera"></label>
              <label>Commentaire <textarea name="q3_ordre_disposition_ko_commentaire" rows="2"></textarea></label>
            </div>
          </div>

          <div class="q">
            <span>4. Cerclage bien appliqu√© ?</span>
            <div class="row">
              <label><input type="radio" name="q4_cerclage_ok" value="OK" checked> OK</label>
              <label><input type="radio" name="q4_cerclage_ok" value="KO"> Pas OK</label>
            </div>
            <div class="ko-fields" data-ko="q4_cerclage_ok">
              <label>Photo probl√®me <input type="file" name="q4_cerclage_ko_photo" accept="image/*;capture=camera"></label>
              <label>Commentaire <textarea name="q4_cerclage_ko_commentaire" rows="2"></textarea></label>
            </div>
          </div>

          <div class="q">
            <span>5. Palette stable ?</span>
            <div class="row">
              <label><input type="radio" name="q5_stabilite_ok" value="OK" checked> OK</label>
              <label><input type="radio" name="q5_stabilite_ok" value="KO"> Pas OK</label>
            </div>
            <div class="ko-fields" data-ko="q5_stabilite_ok">
              <label>Photo probl√®me <input type="file" name="q5_stabilite_ko_photo" accept="image/*;capture=camera"></label>
              <label>Commentaire <textarea name="q5_stabilite_ko_commentaire" rows="2"></textarea></label>
            </div>
          </div>
        </fieldset>

        <button class="primary" type="submit">Enregistrer</button>
        <div class="toast" id="toastPaAv"></div>
      </form>
    </section>

    <!-- Palettes Destination -->
    <section id="tab-palettes_dest" class="tab">
      <form id="formPaDest" class="qc-form" enctype="multipart/form-data">
        <input type="hidden" name="route" value="qc">
        <input type="hidden" name="type" value="Palettes_Destination">

        <label>Date du jour <input type="date" name="date_jour" required /></label>

        <div class="group">
          <label>Scanner le code-barres (photo)
            <input type="file" id="paDeScan" accept="image/*;capture=camera" />
          </label>
          <div class="row">
            <input type="text" name="code_barres" id="paDeCode" inputmode="numeric" pattern="\\d*" placeholder="Code-barres palette" required />
            <button type="button" class="btn" id="btnDecodePaDe">D√©coder</button>
          </div>
        </div>

        <label>Photo principale de la palette
          <input type="file" name="photo_principale" accept="image/*;capture=camera" required />
        </label>

        <fieldset>
          <legend>Contr√¥les</legend>

          <div class="q">
            <span>1. Cartons en bon √©tat ?</span>
            <div class="row">
              <label><input type="radio" name="q1_etat_ok" value="OK" checked> OK</label>
              <label><input type="radio" name="q1_etat_ok" value="KO"> Pas OK</label>
            </div>
            <div class="ko-fields" data-ko="q1_etat_ok">
              <label>Photo probl√®me <input type="file" name="q1_etat_ko_photo" accept="image/*;capture=camera"></label>
              <label>Commentaire <textarea name="q1_etat_ko_commentaire" rows="2"></textarea></label>
            </div>
          </div>

          <div class="q">
            <span>2. Cerclage bien appliqu√© ?</span>
            <div class="row">
              <label><input type="radio" name="q2_cerclage_ok" value="OK" checked> OK</label>
              <label><input type="radio" name="q2_cerclage_ok" value="KO"> Pas OK</label>
            </div>
            <div class="ko-fields" data-ko="q2_cerclage_ok">
              <label>Photo probl√®me <input type="file" name="q2_cerclage_ko_photo" accept="image/*;capture=camera"></label>
              <label>Commentaire <textarea name="q2_cerclage_ko_commentaire" rows="2"></textarea></label>
            </div>
          </div>
        </fieldset>

        <button class="primary" type="submit">Enregistrer</button>
        <div class="toast" id="toastPaDe"></div>
      </form>
    </section>

    <!-- KPI -->
    <section id="tab-kpi" class="tab">
      <div class="row">
        <label>Type
          <select id="kpiType">
            <option value="ALL">Tous</option>
            <option value="Cartons">Cartons</option>
            <option value="Palettes_Avant">Palettes_Avant</option>
            <option value="Palettes_Destination">Palettes_Destination</option>
          </select>
        </label>
        <button class="btn" id="btnLoadKpi">Charger KPI</button>
      </div>
      <div id="kpiSummary"></div>
      <h3>Par date</h3>
      <div id="kpiDate"></div>
      <h3>Top non-conformit√©s</h3>
      <div id="kpiQuestions"></div>
    </section>

    <!-- Export -->
    <section id="tab-export" class="tab">
      <div class="row">
        <label>Du <input type="date" id="exportFrom"></label>
        <label>Au <input type="date" id="exportTo"></label>
        <button class="btn" id="btnExport">T√©l√©charger Excel</button>
      </div>
      <p>Si vous laissez vide, l‚Äôexport contiendra toutes les lignes.</p>
    </section>

  </main>

  <footer>
    <small>¬© QC Mobile ‚Äî Pelichet ‚Äî Mode public (sans authentification)</small>
  </footer>
</body>
</html>
