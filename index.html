<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#FF6A00" />
  <title>Pelichet QC</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" type="image/png" sizes="16x16" href="icon-16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icon-32.png">
  <link rel="apple-touch-icon" href="icon-180.png">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- ========== HEADER ========== -->
  <header class="app-header">
    <div class="brand">
      <img src="logo-pelichet.svg" alt="Pelichet QC" class="logo">
    </div>
    <nav class="tabs">
      <button class="tab active" data-tab="cartons">Cartons</button>
      <button class="tab" data-tab="palettes-avant">Palettes Avant</button>
      <button class="tab" data-tab="palettes-destination">Palettes Destination</button>
      <button class="tab" data-tab="kpi">KPI</button>
    </nav>
    <div class="actions">
      <button id="toggleTheme" class="icon-btn" title="Th√®me clair/sombre">üåì</button>
    </div>
  </header>

  <!-- ========== CONTENU ========== -->
  <main class="container">

    <!-- ====== ONGLET CARTONS ====== -->
    <section id="tab-cartons" class="tab-pane active">
      <h2>Contr√¥le ‚Äî Cartons</h2>
      <form class="qc-form" data-type="Cartons">
        <div class="card grid-2">
          <div>
            <label>Date du contr√¥le</label>
            <input type="date" name="date_jour" required>
          </div>
          <div>
            <label>Photo principale (carton)</label>
            <input type="file" id="cartons_photo_cam" accept="image/*" capture="environment" style="display:none">
            <input type="file" id="cartons_photo_gal" accept="image/*" style="display:none">
            <input type="file" name="photo_principale" id="cartons_photo_target" accept="image/*" style="display:none">
            <div class="row gap">
              <button type="button" class="btn" id="btnCartonsPhotoCam">üì∑ Prendre photo</button>
              <button type="button" class="btn secondary" id="btnCartonsPhotoGal">üñºÔ∏è Galerie</button>
              <span id="cartons_photo_label" class="file-label"></span>
            </div>
          </div>
        </div>

        <!-- Code-barres -->
        <div class="card">
          <label>D√©coder un code-barres (photo)</label>
          <input type="file" id="cartons_bc_cam" accept="image/*" capture="environment" style="display:none">
          <input type="file" id="cartons_bc_gal" accept="image/*" style="display:none">
          <input type="file" id="cartons_barcode_file" accept="image/*" style="display:none">
          <div class="row gap">
            <button type="button" class="btn" id="btnCartonsBcCam">üì∑ Prendre photo</button>
            <button type="button" class="btn secondary" id="btnCartonsBcGal">üñºÔ∏è Galerie</button>
            <button type="button" class="btn" data-action="decode" data-target="cartons_barcode_file" data-out="cartons_code_barres">D√©coder</button>
            <span id="cartons_bc_label" class="file-label"></span>
          </div>
          <input type="text" name="code_barres" id="cartons_code_barres" placeholder="Code-barres" required>
        </div>

        <!-- Questions -->
        <div class="card">
          <h3>Contr√¥les</h3>

          <!-- Chaque question -->
          <template id="tpl-carton-question">
            <div class="card question">
              <label></label>
              <div class="okko">
                <label><input type="radio" value="OK" checked> OK</label>
                <label><input type="radio" value="KO"> KO</label>
              </div>
              <div class="ko-extra">
                <label>Photos du probl√®me (plusieurs possibles)</label>
                <input type="file" accept="image/*" multiple>
                <label>Description</label>
                <textarea></textarea>
              </div>
            </div>
          </template>

          <!-- Liste des questions -->
          <div class="card">
            <label>Le calage papier est-il bien fait ?</label>
            <div class="okko">
              <label><input type="radio" name="callage_papier" value="OK" checked> OK</label>
              <label><input type="radio" name="callage_papier" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="callage_papier">
              <input type="file" accept="image/*" data-photofor="callage_papier" multiple>
              <textarea data-commentfor="callage_papier" placeholder="D√©crire le probl√®me..."></textarea>
            </div>
          </div>

          <div class="card">
            <label>Y a-t-il des intercalaires pour s√©parer les colonnes de livres ?</label>
            <div class="okko">
              <label><input type="radio" name="intercalaires_livres" value="OK" checked> OK</label>
              <label><input type="radio" name="intercalaires_livres" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="intercalaires_livres">
              <input type="file" accept="image/*" data-photofor="intercalaires_livres" multiple>
              <textarea data-commentfor="intercalaires_livres"></textarea>
            </div>
          </div>

          <div class="card">
            <label>L‚Äôordre des colonnes et la disposition sont-ils respect√©s ?</label>
            <div class="okko">
              <label><input type="radio" name="ordre_colonnes" value="OK" checked> OK</label>
              <label><input type="radio" name="ordre_colonnes" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="ordre_colonnes">
              <input type="file" accept="image/*" data-photofor="ordre_colonnes" multiple>
              <textarea data-commentfor="ordre_colonnes"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Le scotch est-il bien appliqu√© ?</label>
            <div class="okko">
              <label><input type="radio" name="scotch" value="OK" checked> OK</label>
              <label><input type="radio" name="scotch" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="scotch">
              <input type="file" accept="image/*" data-photofor="scotch" multiple>
              <textarea data-commentfor="scotch"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Les livres ont-ils bien √©t√© d√©poussi√©r√©s ?</label>
            <div class="okko">
              <label><input type="radio" name="depoussierage" value="OK" checked> OK</label>
              <label><input type="radio" name="depoussierage" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="depoussierage">
              <input type="file" accept="image/*" data-photofor="depoussierage" multiple>
              <textarea data-commentfor="depoussierage"></textarea>
            </div>
          </div>
        </div>

        <button class="btn" type="submit" style="width:100%">Enregistrer</button>
        <div class="result"></div>
      </form>
    </section>

    <!-- ====== ONGLET PALETTES AVANT ====== -->
    <section id="tab-palettes-avant" class="tab-pane">
      <h2>Contr√¥le ‚Äî Palettes (Avant)</h2>
      <form class="qc-form" data-type="Palettes_Avant">
        <div class="card grid-2">
          <div>
            <label>Date du contr√¥le</label>
            <input type="date" name="date_jour" required>
          </div>
          <div>
            <label>Photo principale</label>
            <input type="file" id="pa_photo_cam" accept="image/*" capture="environment" style="display:none">
            <input type="file" id="pa_photo_gal" accept="image/*" style="display:none">
            <input type="file" name="photo_principale" id="pa_photo_target" accept="image/*" style="display:none">
            <div class="row gap">
              <button type="button" class="btn" id="btnPaPhotoCam">üì∑ Prendre photo</button>
              <button type="button" class="btn secondary" id="btnPaPhotoGal">üñºÔ∏è Galerie</button>
              <span id="pa_photo_label" class="file-label"></span>
            </div>
          </div>
        </div>

        <div class="card">
          <label>D√©coder un code-barres palette</label>
          <input type="file" id="pa_bc_cam" accept="image/*" capture="environment" style="display:none">
          <input type="file" id="pa_bc_gal" accept="image/*" style="display:none">
          <input type="file" id="pa_barcode_file" accept="image/*" style="display:none">
          <div class="row gap">
            <button type="button" class="btn" id="btnPaBcCam">üì∑ Prendre photo</button>
            <button type="button" class="btn secondary" id="btnPaBcGal">üñºÔ∏è Galerie</button>
            <button type="button" class="btn" data-action="decode" data-target="pa_barcode_file" data-out="pa_code_barres">D√©coder</button>
            <span id="pa_bc_label" class="file-label"></span>
          </div>
          <input type="text" name="code_barres" id="pa_code_barres" placeholder="Code-barres" required>
        </div>

        <!-- (Questions identiques √† ta version pr√©c√©dente si besoin) -->

        <button class="btn" type="submit" style="width:100%">Enregistrer</button>
        <div class="result"></div>
      </form>
    </section>

    <!-- ====== ONGLET PALETTES DESTINATION ====== -->
    <section id="tab-palettes-destination" class="tab-pane">
      <h2>Contr√¥le ‚Äî Palettes (Destination)</h2>
      <form class="qc-form" data-type="Palettes_Destination">
        <div class="card grid-2">
          <div>
            <label>Date du contr√¥le</label>
            <input type="date" name="date_jour" required>
          </div>
          <div>
            <label>Photo principale</label>
            <input type="file" id="pd_photo_cam" accept="image/*" capture="environment" style="display:none">
            <input type="file" id="pd_photo_gal" accept="image/*" style="display:none">
            <input type="file" name="photo_principale" id="pd_photo_target" accept="image/*" style="display:none">
            <div class="row gap">
              <button type="button" class="btn" id="btnPdPhotoCam">üì∑ Prendre photo</button>
              <button type="button" class="btn secondary" id="btnPdPhotoGal">üñºÔ∏è Galerie</button>
              <span id="pd_photo_label" class="file-label"></span>
            </div>
          </div>
        </div>

        <div class="card">
          <label>D√©coder un code-barres</label>
          <input type="file" id="pd_bc_cam" accept="image/*" capture="environment" style="display:none">
          <input type="file" id="pd_bc_gal" accept="image/*" style="display:none">
          <input type="file" id="pd_barcode_file" accept="image/*" style="display:none">
          <div class="row gap">
            <button type="button" class="btn" id="btnPdBcCam">üì∑ Prendre photo</button>
            <button type="button" class="btn secondary" id="btnPdBcGal">üñºÔ∏è Galerie</button>
            <button type="button" class="btn" data-action="decode" data-target="pd_barcode_file" data-out="pd_code_barres">D√©coder</button>
            <span id="pd_bc_label" class="file-label"></span>
          </div>
          <input type="text" name="code_barres" id="pd_code_barres" placeholder="Code-barres" required>
        </div>

        <button class="btn" type="submit" style="width:100%">Enregistrer</button>
        <div class="result"></div>
      </form>
    </section>

    <!-- ====== KPI ====== -->
    <section id="tab-kpi" class="tab-pane">
      <h2>Tableau de bord KPI</h2>
      <div class="row gap">
        <label for="kpi_from">Du :</label><input type="date" id="kpi_from">
        <label for="kpi_to">au :</label><input type="date" id="kpi_to">
        <button class="btn" id="btnKpi">Afficher</button>
        <button class="btn secondary" id="btnExport">Export Excel</button>
      </div>
      <div id="kpiResults" class="kpi-wrap"></div>
    </section>
  </main>

  <footer class="center" style="margin:40px 0; font-size:14px; color:var(--muted)">
    ¬© Pelichet ‚Äî QC
  </footer>

  <!-- Librairies externes -->
  <script src="https://unpkg.com/@zxing/browser@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>

  <!-- Script principal -->
  <script src="app.js"></script>

  <!-- Date du jour auto -->
  <script>
  document.addEventListener('DOMContentLoaded',()=>{
    const pad=n=>String(n).padStart(2,'0');
    const d=new Date();
    const val=d.getFullYear()+'-'+pad(d.getMonth()+1)+'-'+pad(d.getDate());
    document.querySelectorAll('input[type="date"]').forEach(inp=>{
      if(!inp.value) inp.value=val;
    });
  });
  </script>
</body>
</html>
