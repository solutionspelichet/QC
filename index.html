<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#FF6A00" />
  <title>Pelichet QC</title>

  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" type="image/png" sizes="16x16" href="icon-16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icon-32.png">
  <link rel="apple-touch-icon" href="icon-180.png">

  <link rel="stylesheet" href="style.css">
</head>
<body>

  <header class="app-header">
    <div class="brand">
      <img src="logo-pelichet.svg" alt="Pelichet QC" class="logo">
    </div>
    <nav class="tabs">
      <button class="tab active" data-tab="cartons">Cartons</button>
      <button class="tab" data-tab="palettes-avant">Palettes Avant</button>
      <button class="tab" data-tab="palettes-destination">Palettes Destination</button>
      <button class="tab" data-tab="kpi">KPI</button>
    </nav>
    <div class="actions">
      <button id="toggleTheme" class="icon-btn" title="Th√®me clair/sombre">üåì</button>
    </div>
  </header>

<main>
  <!-- Cartons -->
  <section id="tab-cartons" class="tab-pane active" data-type="Cartons">
    <form class="qc-form" data-type="Cartons">
      <div class="field">
        <label>Date du jour</label>
        <input type="date" name="date_jour" required/>
      </div>

      <div class="field">
        <label>Scan code-barres (photo)</label>
        <input type="file" accept="image/*" capture="environment" id="cb_cartons" />
        <button type="button" class="btn" data-action="decode" data-target="cb_cartons" data-out="code_cartons">D√©coder</button>
        <input type="text" id="code_cartons" name="code_barres" placeholder="Code-barres" inputmode="numeric" pattern="[0-9]*" required/>
      </div>

      <div class="field">
        <label>Photo principale du carton</label>
        <input type="file" accept="image/*" capture="environment" name="photo_principale"/>
      </div>

      <fieldset>
        <legend>Contr√¥les</legend>
        <!-- 1 -->
        <div class="q">
          <label>Callage papier bien fait ?</label>
          <div class="okko">
            <label><input type="radio" name="callage_papier" value="OK" required> OK</label>
            <label><input type="radio" name="callage_papier" value="KO"> Pas OK</label>
          </div>
          <div class="ko-extra" data-for="callage_papier">
            <label>Photo probl√®me</label>
            <input type="file" accept="image/*" capture="environment" data-photofor="callage_papier">
            <label>Description</label>
            <textarea data-commentfor="callage_papier" maxlength="500"></textarea>
          </div>
        </div>
        <!-- 2 -->
        <div class="q">
          <label>Intercalaires pour s√©parer les colonnes de livres ?</label>
          <div class="okko">
            <label><input type="radio" name="intercalaires_livres" value="OK" required> OK</label>
            <label><input type="radio" name="intercalaires_livres" value="KO"> Pas OK</label>
          </div>
          <div class="ko-extra" data-for="intercalaires_livres">
            <label>Photo probl√®me</label>
            <input type="file" accept="image/*" capture="environment" data-photofor="intercalaires_livres">
            <label>Description</label>
            <textarea data-commentfor="intercalaires_livres" maxlength="500"></textarea>
          </div>
        </div>
        <!-- 3 -->
        <div class="q">
          <label>Ordre des colonnes & disposition respect√©s ?</label>
          <div class="okko">
            <label><input type="radio" name="ordre_colonnes" value="OK" required> OK</label>
            <label><input type="radio" name="ordre_colonnes" value="KO"> Pas OK</label>
          </div>
          <div class="ko-extra" data-for="ordre_colonnes">
            <label>Photo probl√®me</label>
            <input type="file" accept="image/*" capture="environment" data-photofor="ordre_colonnes">
            <label>Description</label>
            <textarea data-commentfor="ordre_colonnes" maxlength="500"></textarea>
          </div>
        </div>
        <!-- 4 -->
        <div class="q">
          <label>Scotch bien appliqu√© ?</label>
          <div class="okko">
            <label><input type="radio" name="scotch" value="OK" required> OK</label>
            <label><input type="radio" name="scotch" value="KO"> Pas OK</label>
          </div>
          <div class="ko-extra" data-for="scotch">
            <label>Photo probl√®me</label>
            <input type="file" accept="image/*" capture="environment" data-photofor="scotch">
            <label>Description</label>
            <textarea data-commentfor="scotch" maxlength="500"></textarea>
          </div>
        </div>
        <!-- 5 -->
        <div class="q">
          <label>Livres d√©poussi√©r√©s ?</label>
          <div class="okko">
            <label><input type="radio" name="depoussierage" value="OK" required> OK</label>
            <label><input type="radio" name="depoussierage" value="KO"> Pas OK</label>
          </div>
          <div class="ko-extra" data-for="depoussierage">
            <label>Photo probl√®me</label>
            <input type="file" accept="image/*" capture="environment" data-photofor="depoussierage">
            <label>Description</label>
            <textarea data-commentfor="depoussierage" maxlength="500"></textarea>
          </div>
        </div>
      </fieldset>

      <button type="submit" class="btn primary">Enregistrer</button>
      <p class="hint">R√®gle : tout **KO** ‚áí photo + commentaire obligatoires.</p>
      <div class="result" aria-live="polite"></div>
    </form>
  </section>

  <!-- Palettes Avant -->
  <section id="tab-palettes_avant" class="tab-pane" data-type="Palettes_Avant">
    <form class="qc-form" data-type="Palettes_Avant">
      <div class="field">
        <label>Date du jour</label>
        <input type="date" name="date_jour" required/>
      </div>

      <div class="field">
        <label>Scan code-barres palette (photo)</label>
        <input type="file" accept="image/*" capture="environment" id="cb_pa"/>
        <button type="button" class="btn" data-action="decode" data-target="cb_pa" data-out="code_pa">D√©coder</button>
        <input type="text" id="code_pa" name="code_barres" placeholder="Code-barres palette" inputmode="numeric" pattern="[0-9]*" required/>
      </div>

      <div class="field">
        <label>Photo principale de la palette</label>
        <input type="file" accept="image/*" capture="environment" name="photo_principale"/>
      </div>

      <fieldset>
        <legend>Contr√¥les</legend>
        <div class="q">
          <label>Cartons en bon √©tat ?</label>
          <div class="okko">
            <label><input type="radio" name="cartons_etat" value="OK" required> OK</label>
            <label><input type="radio" name="cartons_etat" value="KO"> Pas OK</label>
          </div>
          <div class="ko-extra" data-for="cartons_etat">
            <label>Photo probl√®me</label>
            <input type="file" accept="image/*" capture="environment" data-photofor="cartons_etat">
            <label>Description</label>
            <textarea data-commentfor="cartons_etat" maxlength="500"></textarea>
          </div>
        </div>

        <div class="q">
          <label>Intercalaires pour s√©parer les cartons ?</label>
          <div class="okko">
            <label><input type="radio" name="intercalaires_cartons" value="OK" required> OK</label>
            <label><input type="radio" name="intercalaires_cartons" value="KO"> Pas OK</label>
          </div>
          <div class="ko-extra" data-for="intercalaires_cartons">
            <label>Photo probl√®me</label>
            <input type="file" accept="image/*" capture="environment" data-photofor="intercalaires_cartons">
            <label>Description</label>
            <textarea data-commentfor="intercalaires_cartons" maxlength="500"></textarea>
          </div>
        </div>

        <div class="q">
          <label>Ordre & disposition des cartons respect√©s ?</label>
          <div class="okko">
            <label><input type="radio" name="ordre_cartons" value="OK" required> OK</label>
            <label><input type="radio" name="ordre_cartons" value="KO"> Pas OK</label>
          </div>
          <div class="ko-extra" data-for="ordre_cartons">
            <label>Photo probl√®me</label>
            <input type="file" accept="image/*" capture="environment" data-photofor="ordre_cartons">
            <label>Description</label>
            <textarea data-commentfor="ordre_cartons" maxlength="500"></textarea>
          </div>
        </div>

        <div class="q">
          <label>Cerclage bien appliqu√© ?</label>
          <div class="okko">
            <label><input type="radio" name="cerclage" value="OK" required> OK</label>
            <label><input type="radio" name="cerclage" value="KO"> Pas OK</label>
          </div>
          <div class="ko-extra" data-for="cerclage">
            <label>Photo probl√®me</label>
            <input type="file" accept="image/*" capture="environment" data-photofor="cerclage">
            <label>Description</label>
            <textarea data-commentfor="cerclage" maxlength="500"></textarea>
          </div>
        </div>

        <div class="q">
          <label>Palette stable ?</label>
          <div class="okko">
            <label><input type="radio" name="stabilite" value="OK" required> OK</label>
            <label><input type="radio" name="stabilite" value="KO"> Pas OK</label>
          </div>
          <div class="ko-extra" data-for="stabilite">
            <label>Photo probl√®me</label>
            <input type="file" accept="image/*" capture="environment" data-photofor="stabilite">
            <label>Description</label>
            <textarea data-commentfor="stabilite" maxlength="500"></textarea>
          </div>
        </div>
      </fieldset>

      <button type="submit" class="btn primary">Enregistrer</button>
      <p class="hint">R√®gle : tout **KO** ‚áí photo + commentaire obligatoires.</p>
      <div class="result" aria-live="polite"></div>
    </form>
  </section>

  <!-- Palettes Destination -->
  <section id="tab-palettes_dest" class="tab-pane" data-type="Palettes_Destination">
    <form class="qc-form" data-type="Palettes_Destination">
      <div class="field">
        <label>Date du jour</label>
        <input type="date" name="date_jour" required/>
      </div>

      <div class="field">
        <label>Scan code-barres (photo)</label>
        <input type="file" accept="image/*" capture="environment" id="cb_pd"/>
        <button type="button" class="btn" data-action="decode" data-target="cb_pd" data-out="code_pd">D√©coder</button>
        <input type="text" id="code_pd" name="code_barres" placeholder="Code-barres palette" inputmode="numeric" pattern="[0-9]*" required/>
      </div>

      <div class="field">
        <label>Photo principale de la palette</label>
        <input type="file" accept="image/*" capture="environment" name="photo_principale"/>
      </div>

      <fieldset>
        <legend>Contr√¥les</legend>
        <div class="q">
          <label>Cartons en bon √©tat ?</label>
          <div class="okko">
            <label><input type="radio" name="cartons_etat" value="OK" required> OK</label>
            <label><input type="radio" name="cartons_etat" value="KO"> Pas OK</label>
          </div>
          <div class="ko-extra" data-for="cartons_etat">
            <label>Photo probl√®me</label>
            <input type="file" accept="image/*" capture="environment" data-photofor="cartons_etat">
            <label>Description</label>
            <textarea data-commentfor="cartons_etat" maxlength="500"></textarea>
          </div>
        </div>

        <div class="q">
          <label>Cerclage bien appliqu√© ?</label>
          <div class="okko">
            <label><input type="radio" name="cerclage" value="OK" required> OK</label>
            <label><input type="radio" name="cerclage" value="KO"> Pas OK</label>
          </div>
          <div class="ko-extra" data-for="cerclage">
            <label>Photo probl√®me</label>
            <input type="file" accept="image/*" capture="environment" data-photofor="cerclage">
            <label>Description</label>
            <textarea data-commentfor="cerclage" maxlength="500"></textarea>
          </div>
        </div>
      </fieldset>

      <button type="submit" class="btn primary">Enregistrer</button>
      <p class="hint">R√®gle : tout **KO** ‚áí photo + commentaire obligatoires.</p>
      <div class="result" aria-live="polite"></div>
    </form>
  </section>

  <!-- KPI -->
  <section id="tab-kpi" class="tab-pane">
    <div class="kpi-controls">
      <label>Du</label><input type="date" id="kpi_from">
      <label>Au</label><input type="date" id="kpi_to">
      <button id="btnKpi" class="btn">Actualiser KPI</button>
      <button id="btnExport" class="btn">Exporter Excel</button>
    </div>
    <div id="kpiResults"></div>
  </section>
</main>

<footer>
  <small>¬© Pelichet ‚Äî QC</small>
</footer>

<script src="https://unpkg.com/@zxing/browser@latest"></script>
<script src="app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
</body>
</html>
