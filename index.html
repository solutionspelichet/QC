<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#FF6A00" />
  <title>Pelichet QC</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" type="image/png" sizes="16x16" href="icon-16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icon-32.png">
  <link rel="apple-touch-icon" href="icon-180.png">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- ===== HEADER ===== -->
  <header class="app-header">
    <div class="brand">
      <img src="logo-pelichet.svg" alt="Pelichet QC" class="logo">
    </div>
    <nav class="tabs">
      <button class="tab active" data-tab="cartons">Cartons</button>
      <button class="tab" data-tab="palettes-avant">Palettes Avant</button>
      <button class="tab" data-tab="palettes-destination">Palettes Destination</button>
      <button class="tab" data-tab="kpi">KPI</button>
    </nav>
    <div class="actions">
      <button id="toggleTheme" class="icon-btn" title="Th√®me clair/sombre">üåì</button>
    </div>
  </header>

  <!-- ===== CONTENU ===== -->
  <main class="container">

    <!-- ---------- ONGLET CARTONS ---------- -->
    <section id="tab-cartons" class="tab-pane active">
      <h2>Contr√¥le ‚Äî Cartons</h2>
      <form class="qc-form" data-type="Cartons">

        <div class="card grid-2">
          <div>
            <label>Date du contr√¥le</label>
            <input type="date" name="date_jour" required>
          </div>

          <!-- Photo principale -->
          <div>
            <label>Photo principale (carton)</label>
            <input type="file" id="cartons_photo_cam" accept="image/*" capture="environment" style="display:none">
            <input type="file" id="cartons_photo_gal" accept="image/*" style="display:none">
            <input type="file" name="photo_principale" id="cartons_photo_target" accept="image/*" style="display:none">
            <div class="row gap">
              <button type="button" class="btn" id="btnCartonsPhotoCam">üì∑ Prendre photo</button>
              <button type="button" class="btn secondary" id="btnCartonsPhotoGal">üñºÔ∏è Galerie</button>
              <span id="cartons_photo_label" class="file-label"></span>
            </div>
          </div>
        </div>

        <!-- D√©codage du code-barres -->
        <div class="card">
          <label>D√©coder un code-barres (photo)</label>
          <input type="file" id="cartons_bc_cam" accept="image/*" capture="environment" style="display:none">
          <input type="file" id="cartons_bc_gal" accept="image/*" style="display:none">
          <input type="file" accept="image/*" id="cartons_barcode_file" style="display:none">
          <div class="row gap">
            <button type="button" class="btn" id="btnCartonsBcCam">üì∑ Prendre photo</button>
            <button type="button" class="btn secondary" id="btnCartonsBcGal">üñºÔ∏è Galerie</button>
            <button type="button" class="btn" data-action="decode" data-target="cartons_barcode_file" data-out="cartons_code_barres">D√©coder</button>
            <span id="cartons_bc_label" class="file-label"></span>
          </div>
          <input type="text" name="code_barres" id="cartons_code_barres" placeholder="Code-barres" required>
        </div>

        <!-- Questions -->
        <div class="card">
          <h3>Contr√¥les</h3>

          <div class="card">
            <label>Le calage papier est-il bien fait ?</label>
            <div class="okko">
              <label><input type="radio" name="callage_papier" value="OK" checked> OK</label>
              <label><input type="radio" name="callage_papier" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="callage_papier">
              <label>Photos du probl√®me (plusieurs possibles)</label>
              <input type="file" accept="image/*" data-photofor="callage_papier" multiple>
              <label>Description</label>
              <textarea data-commentfor="callage_papier"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Y a-t-il des intercalaires pour s√©parer les colonnes de livres ?</label>
            <div class="okko">
              <label><input type="radio" name="intercalaires_livres" value="OK" checked> OK</label>
              <label><input type="radio" name="intercalaires_livres" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="intercalaires_livres">
              <input type="file" accept="image/*" data-photofor="intercalaires_livres" multiple>
              <textarea data-commentfor="intercalaires_livres"></textarea>
            </div>
          </div>

          <div class="card">
            <label>L‚Äôordre des colonnes et la disposition sont-ils respect√©s ?</label>
            <div class="okko">
              <label><input type="radio" name="ordre_colonnes" value="OK" checked> OK</label>
              <label><input type="radio" name="ordre_colonnes" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="ordre_colonnes">
              <input type="file" accept="image/*" data-photofor="ordre_colonnes" multiple>
              <textarea data-commentfor="ordre_colonnes"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Le scotch est-il bien appliqu√© ?</label>
            <div class="okko">
              <label><input type="radio" name="scotch" value="OK" checked> OK</label>
              <label><input type="radio" name="scotch" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="scotch">
              <input type="file" accept="image/*" data-photofor="scotch" multiple>
              <textarea data-commentfor="scotch"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Les livres ont-ils bien √©t√© d√©poussi√©r√©s ?</label>
            <div class="okko">
              <label><input type="radio" name="depoussierage" value="OK" checked> OK</label>
              <label><input type="radio" name="depoussierage" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="depoussierage">
              <input type="file" accept="image/*" data-photofor="depoussierage" multiple>
              <textarea data-commentfor="depoussierage"></textarea>
            </div>
          </div>
        </div>

        <button class="btn" type="submit" style="width:100%">Enregistrer</button>
        <div class="result"></div>
      </form>
    </section>

    <!-- ---------- ONGLET PALETTES AVANT ---------- -->
    <section id="tab-palettes-avant" class="tab-pane">
      <h2>Contr√¥le ‚Äî Palettes (Avant)</h2>
      <form class="qc-form" data-type="Palettes_Avant">
        <div class="card grid-2">
          <div>
            <label>Date du contr√¥le</label>
            <input type="date" name="date_jour" required>
          </div>
          <div>
            <label>Photo principale (palette)</label>
            <input type="file" id="pa_photo_cam" accept="image/*" capture="environment" style="display:none">
            <input type="file" id="pa_photo_gal" accept="image/*" style="display:none">
            <input type="file" name="photo_principale" id="pa_photo_target" accept="image/*" style="display:none">
            <div class="row gap">
              <button type="button" class="btn" id="btnPaPhotoCam">üì∑ Prendre photo</button>
              <button type="button" class="btn secondary" id="btnPaPhotoGal">üñºÔ∏è Galerie</button>
              <span id="pa_photo_label" class="file-label"></span>
            </div>
          </div>
        </div>

        <div class="card">
          <label>D√©coder un code-barres palette</label>
          <input type="file" id="pa_bc_cam" accept="image/*" capture="environment" style="display:none">
          <input type="file" id="pa_bc_gal" accept="image/*" style="display:none">
          <input type="file" accept="image/*" id="pa_barcode_file" style="display:none">
          <div class="row gap">
            <button type="button" class="btn" id="btnPaBcCam">üì∑ Prendre photo</button>
            <button type="button" class="btn secondary" id="btnPaBcGal">üñºÔ∏è Galerie</button>
            <button type="button" class="btn" data-action="decode" data-target="pa_barcode_file" data-out="pa_code_barres">D√©coder</button>
            <span id="pa_bc_label" class="file-label"></span>
          </div>
          <input type="text" name="code_barres" id="pa_code_barres" placeholder="Code-barres" required>
        </div>

        <!-- (Questions identiques √† ta version pr√©c√©dente, gard√©es ici si besoin) -->

        <button class="btn" type="submit" style="width:100%">Enregistrer</button>
        <div class="result"></div>
      </form>
    </section>

    <!-- ---------- ONGLET PALETTES DESTINATION ---------- -->
    <section id="tab-palettes-destination" class="tab-pane">
      <h2>Contr√¥le ‚Äî Palettes (Destination)</h2>
      <form class="qc-form" data-type="Palettes_Destination">
        <div class="card grid-2">
          <div>
            <label>Date du contr√¥le</label>
            <input type="date" name="date_jour" required>
          </div>
          <div>
            <label>Photo principale (palette)</label>
            <input type="file" id="pd_photo_cam" accept="image/*" capture="environment" style="display:none">
            <input type="file" id="pd_photo_gal" accept="image/*" style="display:none">
            <input type="file" name="photo_principale" id="pd_photo_target" accept="image/*" style="display:none">
            <div class="row gap">
              <button type="button" class="btn" id="btnPdPhotoCam">üì∑ Prendre photo</button>
              <button type="button" class="btn secondary" id="btnPdPhotoGal">üñºÔ∏è Galerie</button>
              <span id="pd_photo_label" class="file-label"></span>
            </div>
          </div>
        </div>

        <div class="card">
          <label>D√©coder un code-barres</label>
          <input type="file" id="pd_bc_cam" accept="image/*" capture="environment" style="display:none">
          <input type="file" id="pd_bc_gal" accept="image/*" style="display:none">
          <input type="file" accept="image/*" id="pd_barcode_file" style="display:none">
          <div class="row gap">
            <button type="button" class="btn" id="btnPdBcCam">üì∑ Prendre photo</button>
            <button type="button" class="btn secondary" id="btnPdBcGal">üñºÔ∏è Galerie</button>
            <button type="button" class="btn" data-action="decode" data-target="pd_barcode_file" data-out="pd_code_barres">D√©coder</button>
            <span id="pd_bc_label" class="file-label"></span>
          </div>
          <input type="text" name="code_barres" id="pd_code_barres" placeholder="Code-barres" required>
        </div>

        <button class="btn" type="submit" style="width:100%">Enregistrer</button>
        <div class="result"></div>
      </form>
    </section>

    <!-- ---------- KPI ---------- -->
    <section id="tab-kpi" class="tab-pane">
      <h2>Tableau de bord KPI</h2>
      <div class="row gap">
        <label for="kpi_from">Du :</label><input type="date" id="kpi_from">
        <label for="kpi_to">au :</label><input type="date" id="kpi_to">
        <button class="btn" id="btnKpi">Afficher</button>
        <button class="btn secondary" id="btnExport">Export Excel</button>
      </div>
      <div id="kpiResults" class="kpi-wrap"></div>
    </section>
  </main>

  <footer class="center" style="margin:40px 0; font-size:14px; color:var(--muted)">
    ¬© Pelichet ‚Äî QC
  </footer>

  <!-- Librairies externes -->
  <script src="https://unpkg.com/@zxing/browser@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>

  <!-- Script principal -->
  <script src="app.js"></script>

  <!-- Date du jour auto -->
  <script>
  document.addEventListener('DOMContentLoaded',()=>{
    const pad=n=>String(n).padStart(2,'0');
    const d=new Date();
    const val=d.getFullYear()+'-'+pad(d.getMonth()+1)+'-'+pad(d.getDate());
    document.querySelectorAll('input[type="date"]').forEach(inp=>{
      if(!inp.value) inp.value=val;
    });
  });
  </script>
</body>
</html>    <section id="tab-cartons" class="tab-pane active">
      <h2>Contr√¥le ‚Äî Cartons</h2>
      <form class="qc-form" data-type="Cartons">
        <div class="card grid-2">
          <div>
            <label>Date du contr√¥le</label>
            <input type="date" name="date_jour" required>
          </div>

          <!-- Photo principale : Cam√©ra + Galerie -> cible photo_principale -->
          <div>
            <label>Photo principale (carton)</label>
            <input type="file" id="cartons_photo_cam" accept="image/*" capture="environment" style="display:none">
            <input type="file" id="cartons_photo_gal" accept="image/*" style="display:none">
            <input type="file" name="photo_principale" id="cartons_photo_target" accept="image/*" style="display:none">
            <div class="row">
              <button type="button" class="btn" id="btnCartonsPhotoCam">üì∑ Prendre photo</button>
              <button type="button" class="btn secondary" id="btnCartonsPhotoGal">üñºÔ∏è Galerie</button>
              <span id="cartons_photo_label" style="margin-left:8px;color:var(--muted)"></span>
            </div>
          </div>
        </div>

        <!-- Code-barres : Cam√©ra + Galerie -> cible cartons_barcode_file + D√©coder -->
        <div class="card">
          <label>D√©coder un code-barres (photo)</label>
          <input type="file" id="cartons_bc_cam" accept="image/*" capture="environment" style="display:none">
          <input type="file" id="cartons_bc_gal" accept="image/*" style="display:none">
          <input type="file" accept="image/*" id="cartons_barcode_file" style="display:none">
          <div class="row">
            <button type="button" class="btn" id="btnCartonsBcCam">üì∑ Prendre photo</button>
            <button type="button" class="btn secondary" id="btnCartonsBcGal">üñºÔ∏è Galerie</button>
            <button type="button" class="btn" data-action="decode" data-target="cartons_barcode_file" data-out="cartons_code_barres">D√©coder</button>
            <span id="cartons_bc_label" style="margin-left:8px;color:var(--muted)"></span>
          </div>
          <input type="text" name="code_barres" id="cartons_code_barres" placeholder="Code-barres" required>
        </div>

        <div class="card">
          <h3>Contr√¥les</h3>

          <div class="card">
            <label>Le calage papier est-il bien fait ?</label>
            <div class="okko">
              <label><input type="radio" name="callage_papier" value="OK" checked> OK</label>
              <label><input type="radio" name="callage_papier" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="callage_papier">
              <label>Photos du probl√®me (plusieurs possibles)</label>
              <input type="file" accept="image/*" data-photofor="callage_papier" multiple>
              <label>Description</label>
              <textarea data-commentfor="callage_papier" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Y a-t-il des intercalaires pour s√©parer les colonnes de livres ?</label>
            <div class="okko">
              <label><input type="radio" name="intercalaires_livres" value="OK" checked> OK</label>
              <label><input type="radio" name="intercalaires_livres" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="intercalaires_livres">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="intercalaires_livres" multiple>
              <label>Description</label>
              <textarea data-commentfor="intercalaires_livres" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>L‚Äôordre des colonnes et la disposition sont-ils respect√©s ?</label>
            <div class="okko">
              <label><input type="radio" name="ordre_colonnes" value="OK" checked> OK</label>
              <label><input type="radio" name="ordre_colonnes" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="ordre_colonnes">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="ordre_colonnes" multiple>
              <label>Description</label>
              <textarea data-commentfor="ordre_colonnes" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Le scotch est-il bien appliqu√© ?</label>
            <div class="okko">
              <label><input type="radio" name="scotch" value="OK" checked> OK</label>
              <label><input type="radio" name="scotch" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="scotch">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="scotch" multiple>
              <label>Description</label>
              <textarea data-commentfor="scotch" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Les livres ont-ils bien √©t√© d√©poussi√©r√©s ?</label>
            <div class="okko">
              <label><input type="radio" name="depoussierage" value="OK" checked> OK</label>
              <label><input type="radio" name="depoussierage" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="depoussierage">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="depoussierage" multiple>
              <label>Description</label>
              <textarea data-commentfor="depoussierage" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>
        </div>

        <button class="btn" type="submit" style="width:100%">Enregistrer</button>
        <div class="result"></div>
        <p style="color:var(--muted)">R√®gle : toute <strong>KO</strong> ‚áí au moins 1 photo + un commentaire.</p>
      </form>
    </section>

    <!-- ==================== PALETTES AVANT ==================== -->
    <section id="tab-palettes-avant" class="tab-pane">
      <h2>Contr√¥le ‚Äî Palettes (Avant)</h2>
      <form class="qc-form" data-type="Palettes_Avant">
        <div class="card grid-2">
          <div>
            <label>Date du contr√¥le</label>
            <input type="date" name="date_jour" required>
          </div>
          <div>
            <label>Photo principale (palette)</label>
            <input type="file" id="pa_photo_cam" accept="image/*" capture="environment" style="display:none">
            <input type="file" id="pa_photo_gal" accept="image/*" style="display:none">
            <input type="file" name="photo_principale" id="pa_photo_target" accept="image/*" style="display:none">
            <div class="row">
              <button type="button" class="btn" id="btnPaPhotoCam">üì∑ Prendre photo</button>
              <button type="button" class="btn secondary" id="btnPaPhotoGal">üñºÔ∏è Galerie</button>
              <span id="pa_photo_label" style="margin-left:8px;color:var(--muted)"></span>
            </div>
          </div>
        </div>

        <div class="card">
          <label>D√©coder un code-barres palette (photo)</label>
          <input type="file" id="pa_bc_cam" accept="image/*" capture="environment" style="display:none">
          <input type="file" id="pa_bc_gal" accept="image/*" style="display:none">
          <input type="file" accept="image/*" id="pa_barcode_file" style="display:none">
          <div class="row">
            <button type="button" class="btn" id="btnPaBcCam">üì∑ Prendre photo</button>
            <button type="button" class="btn secondary" id="btnPaBcGal">üñºÔ∏è Galerie</button>
            <button type="button" class="btn" data-action="decode" data-target="pa_barcode_file" data-out="pa_code_barres">D√©coder</button>
            <span id="pa_bc_label" style="margin-left:8px;color:var(--muted)"></span>
          </div>
          <input type="text" name="code_barres" id="pa_code_barres" placeholder="Code-barres palette" required>
        </div>

        <div class="card">
          <h3>Contr√¥les</h3>

          <div class="card">
            <label>Les cartons sont-ils en bon √©tat ?</label>
            <div class="okko">
              <label><input type="radio" name="cartons_etat" value="OK" checked> OK</label>
              <label><input type="radio" name="cartons_etat" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="cartons_etat">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="cartons_etat" multiple>
              <label>Description</label>
              <textarea data-commentfor="cartons_etat" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Y a-t-il des intercalaires pour s√©parer les cartons ?</label>
            <div class="okko">
              <label><input type="radio" name="intercalaires_cartons" value="OK" checked> OK</label>
              <label><input type="radio" name="intercalaires_cartons" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="intercalaires_cartons">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="intercalaires_cartons" multiple>
              <label>Description</label>
              <textarea data-commentfor="intercalaires_cartons" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>L‚Äôordre des cartons et la disposition sont-ils respect√©s ?</label>
            <div class="okko">
              <label><input type="radio" name="ordre_cartons" value="OK" checked> OK</label>
              <label><input type="radio" name="ordre_cartons" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="ordre_cartons">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="ordre_cartons" multiple>
              <label>Description</label>
              <textarea data-commentfor="ordre_cartons" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Le cerclage est-il bien appliqu√© ?</label>
            <div class="okko">
              <label><input type="radio" name="cerclage" value="OK" checked> OK</label>
              <label><input type="radio" name="cerclage" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="cerclage">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="cerclage" multiple>
              <label>Description</label>
              <textarea data-commentfor="cerclage" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>La palette est-elle stable ?</label>
            <div class="okko">
              <label><input type="radio" name="stabilite" value="OK" checked> OK</label>
              <label><input type="radio" name="stabilite" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="stabilite">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="stabilite" multiple>
              <label>Description</label>
              <textarea data-commentfor="stabilite" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>
        </div>

        <button class="btn" type="submit" style="width:100%">Enregistrer</button>
        <div class="result"></div>
        <p style="color:var(--muted)">R√®gle : toute <strong>KO</strong> ‚áí au moins 1 photo + un commentaire.</p>
      </form>
    </section>

    <!-- ==================== PALETTES DESTINATION ==================== -->
    <section id="tab-palettes-destination" class="tab-pane">
      <h2>Contr√¥le ‚Äî Palettes (Destination)</h2>
      <form class="qc-form" data-type="Palettes_Destination">
        <div class="card grid-2">
          <div>
            <label>Date du contr√¥le</label>
            <input type="date" name="date_jour" required>
          </div>
          <div>
            <label>Photo principale (palette)</label>
            <input type="file" id="pd_photo_cam" accept="image/*" capture="environment" style="display:none">
            <input type="file" id="pd_photo_gal" accept="image/*" style="display:none">
            <input type="file" name="photo_principale" id="pd_photo_target" accept="image/*" style="display:none">
            <div class="row">
              <button type="button" class="btn" id="btnPdPhotoCam">üì∑ Prendre photo</button>
              <button type="button" class="btn secondary" id="btnPdPhotoGal">üñºÔ∏è Galerie</button>
              <span id="pd_photo_label" style="margin-left:8px;color:var(--muted)"></span>
            </div>
          </div>
        </div>

        <div class="card">
          <label>D√©coder un code-barres (photo)</label>
          <input type="file" id="pd_bc_cam" accept="image/*" capture="environment" style="display:none">
          <input type="file" id="pd_bc_gal" accept="image/*" style="display:none">
          <input type="file" accept="image/*" id="pd_barcode_file" style="display:none">
          <div class="row">
            <button type="button" class="btn" id="btnPdBcCam">üì∑ Prendre photo</button>
            <button type="button" class="btn secondary" id="btnPdBcGal">üñºÔ∏è Galerie</button>
            <button type="button" class="btn" data-action="decode" data-target="pd_barcode_file" data-out="pd_code_barres">D√©coder</button>
            <span id="pd_bc_label" style="margin-left:8px;color:var(--muted)"></span>
          </div>
          <input type="text" name="code_barres" id="pd_code_barres" placeholder="Code-barres" required>
        </div>

        <div class="card">
          <h3>Contr√¥les</h3>

          <div class="card">
            <label>Les cartons sont-ils en bon √©tat ?</label>
            <div class="okko">
              <label><input type="radio" name="cartons_etat" value="OK" checked> OK</label>
              <label><input type="radio" name="cartons_etat" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="cartons_etat">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="cartons_etat" multiple>
              <label>Description</label>
              <textarea data-commentfor="cartons_etat" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Le cerclage est-il bien appliqu√© ?</label>
            <div class="okko">
              <label><input type="radio" name="cerclage" value="OK" checked> OK</label>
              <label><input type="radio" name="cerclage" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="cerclage">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="cerclage" multiple>
              <label>Description</label>
              <textarea data-commentfor="cerclage" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>
        </div>

        <button class="btn" type="submit" style="width:100%">Enregistrer</button>
        <div class="result"></div>
        <p style="color:var(--muted)">R√®gle : toute <strong>KO</strong> ‚áí au moins 1 photo + un commentaire.</p>
      </form>
    </section>

    <!-- ==================== KPI ==================== -->
    <section id="tab-kpi" class="tab-pane">
      <h2>Tableau de bord KPI</h2>
      <div class="row">
        <label for="kpi_from">Du :</label><input type="date" id="kpi_from">
        <label for="kpi_to">au :</label><input type="date" id="kpi_to">
        <button class="btn" id="btnKpi">Afficher</button>
        <button class="btn secondary" id="btnExport">Export Excel</button>
      </div>
      <div id="kpiResults" class="kpi-wrap"></div>
    </section>
  </main>

  <footer class="center" style="margin:40px 0; font-size:14px; color:var(--muted)">
    ¬© Pelichet ‚Äî QC
  </footer>

  <!-- Librairies + App -->
  <script src="https://unpkg.com/@zxing/browser@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
  <script src="app.js"></script>

  <!-- Script inline : hooks Cam√©ra/Galerie + date du jour -->
  <script>
  (function(){
    function copyToTarget(srcInput, targetInput, labelEl){
      if (!srcInput.files || !srcInput.files[0]) return;
      const dt = new DataTransfer();
      dt.items.add(srcInput.files[0]);
      targetInput.files = dt.files;
      if (labelEl) labelEl.textContent = srcInput.files[0].name;
    }
    function hookPair(btnCamId, camId, btnGalId, galId, targetId, labelId){
      const btnCam = document.getElementById(btnCamId);
      const cam = document.getElementById(camId);
      const btnGal = document.getElementById(btnGalId);
      const gal = document.getElementById(galId);
      const tgt = document.getElementById(targetId);
      const label = document.getElementById(labelId);
      if (btnCam && cam) btnCam.addEventListener('click', ()=> cam.click());
      if (btnGal && gal) btnGal.addEventListener('click', ()=> gal.click());
      if (cam && tgt) cam.addEventListener('change', ()=> copyToTarget(cam, tgt, label));
      if (gal && tgt) gal.addEventListener('change', ()=> copyToTarget(gal, tgt, label));
    }

    function setTodayOnAllDates(){
      const pad = n => String(n).padStart(2,'0');
      const d = new Date();
      const val = d.getFullYear() + '-' + pad(d.getMonth()+1) + '-' + pad(d.getDate());
      document.querySelectorAll('input[type="date"]').forEach(inp=>{
        if (!inp.value) inp.value = val; // ne pas √©craser si d√©j√† rempli
      });
    }

    document.addEventListener('DOMContentLoaded', function(){
      // Cartons
      hookPair('btnCartonsPhotoCam','cartons_photo_cam','btnCartonsPhotoGal','cartons_photo_gal','cartons_photo_target','cartons_photo_label');
      hookPair('btnCartonsBcCam','cartons_bc_cam','btnCartonsBcGal','cartons_bc_gal','cartons_barcode_file','cartons_bc_label');
      // Palettes Avant
      hookPair('btnPaPhotoCam','pa_photo_cam','btnPaPhotoGal','pa_photo_gal','pa_photo_target','pa_photo_label');
      hookPair('btnPaBcCam','pa_bc_cam','btnPaBcGal','pa_bc_gal','pa_barcode_file','pa_bc_label');
      // Palettes Destination
      hookPair('btnPdPhotoCam','pd_photo_cam','btnPdPhotoGal','pd_photo_gal','pd_photo_target','pd_photo_label');
      hookPair('btnPdBcCam','pd_bc_cam','btnPdBcGal','pd_bc_gal','pd_barcode_file','pd_bc_label');

      setTodayOnAllDates();
    });
  })();
  </script>
</body>
</html>    <section id="tab-cartons" class="tab-pane active">
      <h2>Contr√¥le ‚Äî Cartons</h2>
      <form class="qc-form" data-type="Cartons">
        <div class="card grid-2">
          <div>
            <label>Date du contr√¥le</label>
            <input type="date" name="date_jour" required>
          </div>

          <!-- Photo principale : Cam√©ra + Galerie -> cible photo_principale -->
          <div>
            <label>Photo principale (carton)</label>
            <input type="file" id="cartons_photo_cam" accept="image/*" capture="environment" style="display:none">
            <input type="file" id="cartons_photo_gal" accept="image/*" style="display:none">
            <input type="file" name="photo_principale" id="cartons_photo_target" accept="image/*" style="display:none">
            <div class="row">
              <button type="button" class="btn" id="btnCartonsPhotoCam">üì∑ Prendre photo</button>
              <button type="button" class="btn secondary" id="btnCartonsPhotoGal">üñºÔ∏è Galerie</button>
              <span id="cartons_photo_label" style="margin-left:8px;color:var(--muted)"></span>
            </div>
          </div>
        </div>

        <!-- Code-barres : Cam√©ra + Galerie -> cible cartons_barcode_file + D√©coder -->
        <div class="card">
          <label>D√©coder un code-barres (photo)</label>
          <input type="file" id="cartons_bc_cam" accept="image/*" capture="environment" style="display:none">
          <input type="file" id="cartons_bc_gal" accept="image/*" style="display:none">
          <input type="file" accept="image/*" id="cartons_barcode_file" style="display:none">
          <div class="row">
            <button type="button" class="btn" id="btnCartonsBcCam">üì∑ Prendre photo</button>
            <button type="button" class="btn secondary" id="btnCartonsBcGal">üñºÔ∏è Galerie</button>
            <button type="button" class="btn" data-action="decode" data-target="cartons_barcode_file" data-out="cartons_code_barres">D√©coder</button>
            <span id="cartons_bc_label" style="margin-left:8px;color:var(--muted)"></span>
          </div>
          <input type="text" name="code_barres" id="cartons_code_barres" placeholder="Code-barres" required>
        </div>

        <div class="card">
          <h3>Contr√¥les</h3>

          <div class="card">
            <label>Le calage papier est-il bien fait ?</label>
            <div class="okko">
              <label><input type="radio" name="callage_papier" value="OK" checked> OK</label>
              <label><input type="radio" name="callage_papier" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="callage_papier">
              <label>Photos du probl√®me (plusieurs possibles)</label>
              <input type="file" accept="image/*" data-photofor="callage_papier" multiple>
              <label>Description</label>
              <textarea data-commentfor="callage_papier" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Y a-t-il des intercalaires pour s√©parer les colonnes de livres ?</label>
            <div class="okko">
              <label><input type="radio" name="intercalaires_livres" value="OK" checked> OK</label>
              <label><input type="radio" name="intercalaires_livres" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="intercalaires_livres">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="intercalaires_livres" multiple>
              <label>Description</label>
              <textarea data-commentfor="intercalaires_livres" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>L‚Äôordre des colonnes et la disposition sont-ils respect√©s ?</label>
            <div class="okko">
              <label><input type="radio" name="ordre_colonnes" value="OK" checked> OK</label>
              <label><input type="radio" name="ordre_colonnes" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="ordre_colonnes">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="ordre_colonnes" multiple>
              <label>Description</label>
              <textarea data-commentfor="ordre_colonnes" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Le scotch est-il bien appliqu√© ?</label>
            <div class="okko">
              <label><input type="radio" name="scotch" value="OK" checked> OK</label>
              <label><input type="radio" name="scotch" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="scotch">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="scotch" multiple>
              <label>Description</label>
              <textarea data-commentfor="scotch" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Les livres ont-ils bien √©t√© d√©poussi√©r√©s ?</label>
            <div class="okko">
              <label><input type="radio" name="depoussierage" value="OK" checked> OK</label>
              <label><input type="radio" name="depoussierage" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="depoussierage">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="depoussierage" multiple>
              <label>Description</label>
              <textarea data-commentfor="depoussierage" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>
        </div>

        <button class="btn" type="submit" style="width:100%">Enregistrer</button>
        <div class="result"></div>
        <p style="color:var(--muted)">R√®gle : toute <strong>KO</strong> ‚áí au moins 1 photo + un commentaire.</p>
      </form>
    </section>

    <!-- ==================== PALETTES AVANT ==================== -->
    <section id="tab-palettes-avant" class="tab-pane">
      <h2>Contr√¥le ‚Äî Palettes (Avant)</h2>
      <form class="qc-form" data-type="Palettes_Avant">
        <div class="card grid-2">
          <div>
            <label>Date du contr√¥le</label>
            <input type="date" name="date_jour" required>
          </div>
          <div>
            <label>Photo principale (palette)</label>
            <input type="file" id="pa_photo_cam" accept="image/*" capture="environment" style="display:none">
            <input type="file" id="pa_photo_gal" accept="image/*" style="display:none">
            <input type="file" name="photo_principale" id="pa_photo_target" accept="image/*" style="display:none">
            <div class="row">
              <button type="button" class="btn" id="btnPaPhotoCam">üì∑ Prendre photo</button>
              <button type="button" class="btn secondary" id="btnPaPhotoGal">üñºÔ∏è Galerie</button>
              <span id="pa_photo_label" style="margin-left:8px;color:var(--muted)"></span>
            </div>
          </div>
        </div>

        <div class="card">
          <label>D√©coder un code-barres palette (photo)</label>
          <input type="file" id="pa_bc_cam" accept="image/*" capture="environment" style="display:none">
          <input type="file" id="pa_bc_gal" accept="image/*" style="display:none">
          <input type="file" accept="image/*" id="pa_barcode_file" style="display:none">
          <div class="row">
            <button type="button" class="btn" id="btnPaBcCam">üì∑ Prendre photo</button>
            <button type="button" class="btn secondary" id="btnPaBcGal">üñºÔ∏è Galerie</button>
            <button type="button" class="btn" data-action="decode" data-target="pa_barcode_file" data-out="pa_code_barres">D√©coder</button>
            <span id="pa_bc_label" style="margin-left:8px;color:var(--muted)"></span>
          </div>
          <input type="text" name="code_barres" id="pa_code_barres" placeholder="Code-barres palette" required>
        </div>

        <div class="card">
          <h3>Contr√¥les</h3>

          <div class="card">
            <label>Les cartons sont-ils en bon √©tat ?</label>
            <div class="okko">
              <label><input type="radio" name="cartons_etat" value="OK" checked> OK</label>
              <label><input type="radio" name="cartons_etat" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="cartons_etat">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="cartons_etat" multiple>
              <label>Description</label>
              <textarea data-commentfor="cartons_etat" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Y a-t-il des intercalaires pour s√©parer les cartons ?</label>
            <div class="okko">
              <label><input type="radio" name="intercalaires_cartons" value="OK" checked> OK</label>
              <label><input type="radio" name="intercalaires_cartons" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="intercalaires_cartons">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="intercalaires_cartons" multiple>
              <label>Description</label>
              <textarea data-commentfor="intercalaires_cartons" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>L‚Äôordre des cartons et la disposition sont-ils respect√©s ?</label>
            <div class="okko">
              <label><input type="radio" name="ordre_cartons" value="OK" checked> OK</label>
              <label><input type="radio" name="ordre_cartons" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="ordre_cartons">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="ordre_cartons" multiple>
              <label>Description</label>
              <textarea data-commentfor="ordre_cartons" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Le cerclage est-il bien appliqu√© ?</label>
            <div class="okko">
              <label><input type="radio" name="cerclage" value="OK" checked> OK</label>
              <label><input type="radio" name="cerclage" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="cerclage">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="cerclage" multiple>
              <label>Description</label>
              <textarea data-commentfor="cerclage" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>La palette est-elle stable ?</label>
            <div class="okko">
              <label><input type="radio" name="stabilite" value="OK" checked> OK</label>
              <label><input type="radio" name="stabilite" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="stabilite">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="stabilite" multiple>
              <label>Description</label>
              <textarea data-commentfor="stabilite" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>
        </div>

        <button class="btn" type="submit" style="width:100%">Enregistrer</button>
        <div class="result"></div>
        <p style="color:var(--muted)">R√®gle : toute <strong>KO</strong> ‚áí au moins 1 photo + un commentaire.</p>
      </form>
    </section>

    <!-- ==================== PALETTES DESTINATION ==================== -->
    <section id="tab-palettes-destination" class="tab-pane">
      <h2>Contr√¥le ‚Äî Palettes (Destination)</h2>
      <form class="qc-form" data-type="Palettes_Destination">
        <div class="card grid-2">
          <div>
            <label>Date du contr√¥le</label>
            <input type="date" name="date_jour" required>
          </div>
          <div>
            <label>Photo principale (palette)</label>
            <input type="file" id="pd_photo_cam" accept="image/*" capture="environment" style="display:none">
            <input type="file" id="pd_photo_gal" accept="image/*" style="display:none">
            <input type="file" name="photo_principale" id="pd_photo_target" accept="image/*" style="display:none">
            <div class="row">
              <button type="button" class="btn" id="btnPdPhotoCam">üì∑ Prendre photo</button>
              <button type="button" class="btn secondary" id="btnPdPhotoGal">üñºÔ∏è Galerie</button>
              <span id="pd_photo_label" style="margin-left:8px;color:var(--muted)"></span>
            </div>
          </div>
        </div>

        <div class="card">
          <label>D√©coder un code-barres (photo)</label>
          <input type="file" id="pd_bc_cam" accept="image/*" capture="environment" style="display:none">
          <input type="file" id="pd_bc_gal" accept="image/*" style="display:none">
          <input type="file" accept="image/*" id="pd_barcode_file" style="display:none">
          <div class="row">
            <button type="button" class="btn" id="btnPdBcCam">üì∑ Prendre photo</button>
            <button type="button" class="btn secondary" id="btnPdBcGal">üñºÔ∏è Galerie</button>
            <button type="button" class="btn" data-action="decode" data-target="pd_barcode_file" data-out="pd_code_barres">D√©coder</button>
            <span id="pd_bc_label" style="margin-left:8px;color:var(--muted)"></span>
          </div>
          <input type="text" name="code_barres" id="pd_code_barres" placeholder="Code-barres" required>
        </div>

        <div class="card">
          <h3>Contr√¥les</h3>

          <div class="card">
            <label>Les cartons sont-ils en bon √©tat ?</label>
            <div class="okko">
              <label><input type="radio" name="cartons_etat" value="OK" checked> OK</label>
              <label><input type="radio" name="cartons_etat" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="cartons_etat">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="cartons_etat" multiple>
              <label>Description</label>
              <textarea data-commentfor="cartons_etat" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Le cerclage est-il bien appliqu√© ?</label>
            <div class="okko">
              <label><input type="radio" name="cerclage" value="OK" checked> OK</label>
              <label><input type="radio" name="cerclage" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="cerclage">
              <label>Photos du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="cerclage" multiple>
              <label>Description</label>
              <textarea data-commentfor="cerclage" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>
        </div>

        <button class="btn" type="submit" style="width:100%">Enregistrer</button>
        <div class="result"></div>
        <p style="color:var(--muted)">R√®gle : toute <strong>KO</strong> ‚áí au moins 1 photo + un commentaire.</p>
      </form>
    </section>

    <!-- ==================== KPI ==================== -->
    <section id="tab-kpi" class="tab-pane">
      <h2>Tableau de bord KPI</h2>
      <div class="row">
        <label for="kpi_from">Du :</label><input type="date" id="kpi_from">
        <label for="kpi_to">au :</label><input type="date" id="kpi_to">
        <button class="btn" id="btnKpi">Afficher</button>
        <button class="btn secondary" id="btnExport">Export Excel</button>
      </div>
      <div id="kpiResults" class="kpi-wrap"></div>
    </section>
  </main>

  <footer class="center" style="margin:40px 0; font-size:14px; color:var(--muted)">
    ¬© Pelichet ‚Äî QC
  </footer>

  <!-- Librairies + App -->
  <script src="https://unpkg.com/@zxing/browser@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
  <script src="app.js"></script>

  <!-- Script inline : hooks Cam√©ra/Galerie + date du jour -->
  <script>
  (function(){
    function copyToTarget(srcInput, targetInput, labelEl){
      if (!srcInput.files || !srcInput.files[0]) return;
      const dt = new DataTransfer();
      dt.items.add(srcInput.files[0]);
      targetInput.files = dt.files;
      if (labelEl) labelEl.textContent = srcInput.files[0].name;
    }
    function hookPair(btnCamId, camId, btnGalId, galId, targetId, labelId){
      const btnCam = document.getElementById(btnCamId);
      const cam = document.getElementById(camId);
      const btnGal = document.getElementById(btnGalId);
      const gal = document.getElementById(galId);
      const tgt = document.getElementById(targetId);
      const label = document.getElementById(labelId);
      if (btnCam && cam) btnCam.addEventListener('click', ()=> cam.click());
      if (btnGal && gal) btnGal.addEventListener('click', ()=> gal.click());
      if (cam && tgt) cam.addEventListener('change', ()=> copyToTarget(cam, tgt, label));
      if (gal && tgt) gal.addEventListener('change', ()=> copyToTarget(gal, tgt, label));
    }

    function setTodayOnAllDates(){
      const pad = n => String(n).padStart(2,'0');
      const d = new Date();
      const val = d.getFullYear() + '-' + pad(d.getMonth()+1) + '-' + pad(d.getDate());
      document.querySelectorAll('input[type="date"]').forEach(inp=>{
        if (!inp.value) inp.value = val; // ne pas √©craser si d√©j√† rempli
      });
    }

    document.addEventListener('DOMContentLoaded', function(){
      // Cartons
      hookPair('btnCartonsPhotoCam','cartons_photo_cam','btnCartonsPhotoGal','cartons_photo_gal','cartons_photo_target','cartons_photo_label');
      hookPair('btnCartonsBcCam','cartons_bc_cam','btnCartonsBcGal','cartons_bc_gal','cartons_barcode_file','cartons_bc_label');
      // Palettes Avant
      hookPair('btnPaPhotoCam','pa_photo_cam','btnPaPhotoGal','pa_photo_gal','pa_photo_target','pa_photo_label');
      hookPair('btnPaBcCam','pa_bc_cam','btnPaBcGal','pa_bc_gal','pa_barcode_file','pa_bc_label');
      // Palettes Destination
      hookPair('btnPdPhotoCam','pd_photo_cam','btnPdPhotoGal','pd_photo_gal','pd_photo_target','pd_photo_label');
      hookPair('btnPdBcCam','pd_bc_cam','btnPdBcGal','pd_bc_gal','pd_barcode_file','pd_bc_label');

      setTodayOnAllDates();
    });
  })();
  </script>
</body>
</html>    <section id="tab-cartons" class="tab-pane active">
      <h2>Contr√¥le ‚Äî Cartons</h2>
      <form class="qc-form" data-type="Cartons">
        <div class="card grid-2">
          <div>
            <label>Date du contr√¥le</label>
            <input type="date" name="date_jour" required>
          </div>

          <!-- Photo principale : Cam√©ra + Galerie -> cible photo_principale -->
          <div>
            <label>Photo principale (carton)</label>
            <!-- entr√©es invisibles -->
            <input type="file" id="cartons_photo_cam" accept="image/*" capture="environment" style="display:none">
            <input type="file" id="cartons_photo_gal" accept="image/*" style="display:none">
            <!-- cible utilis√©e par app.js -->
            <input type="file" name="photo_principale" id="cartons_photo_target" accept="image/*" style="display:none">
            <div class="row">
              <button type="button" class="btn" id="btnCartonsPhotoCam">üì∑ Prendre photo</button>
              <button type="button" class="btn secondary" id="btnCartonsPhotoGal">üñºÔ∏è Galerie</button>
              <span id="cartons_photo_label" style="margin-left:8px;color:var(--muted)"></span>
            </div>
          </div>
        </div>

        <!-- Code-barres : Cam√©ra + Galerie -> cible cartons_barcode_file + D√©coder -->
        <div class="card">
          <label>D√©coder un code-barres (photo)</label>
          <!-- entr√©es invisibles -->
          <input type="file" id="cartons_bc_cam" accept="image/*" capture="environment" style="display:none">
          <input type="file" id="cartons_bc_gal" accept="image/*" style="display:none">
          <!-- cible decode (utilis√©e par le bouton D√©coder / app.js) -->
          <input type="file" accept="image/*" id="cartons_barcode_file" style="display:none">
          <div class="row">
            <button type="button" class="btn" id="btnCartonsBcCam">üì∑ Prendre photo</button>
            <button type="button" class="btn secondary" id="btnCartonsBcGal">üñºÔ∏è Galerie</button>
            <button type="button" class="btn" data-action="decode" data-target="cartons_barcode_file" data-out="cartons_code_barres">D√©coder</button>
            <span id="cartons_bc_label" style="margin-left:8px;color:var(--muted)"></span>
          </div>
          <input type="text" name="code_barres" id="cartons_code_barres" placeholder="Code-barres" required>
        </div>

        <div class="card">
          <h3>Contr√¥les</h3>

          <div class="card">
            <label>Le calage papier est-il bien fait ?</label>
            <div class="okko">
              <label><input type="radio" name="callage_papier" value="OK"> OK</label>
              <label><input type="radio" name="callage_papier" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="callage_papier">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="callage_papier">
              <label>Description</label>
              <textarea data-commentfor="callage_papier" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Y a-t-il des intercalaires pour s√©parer les colonnes de livres ?</label>
            <div class="okko">
              <label><input type="radio" name="intercalaires_livres" value="OK"> OK</label>
              <label><input type="radio" name="intercalaires_livres" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="intercalaires_livres">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="intercalaires_livres">
              <label>Description</label>
              <textarea data-commentfor="intercalaires_livres" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>L‚Äôordre des colonnes et la disposition sont-ils respect√©s ?</label>
            <div class="okko">
              <label><input type="radio" name="ordre_colonnes" value="OK"> OK</label>
              <label><input type="radio" name="ordre_colonnes" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="ordre_colonnes">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="ordre_colonnes">
              <label>Description</label>
              <textarea data-commentfor="ordre_colonnes" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Le scotch est-il bien appliqu√© ?</label>
            <div class="okko">
              <label><input type="radio" name="scotch" value="OK"> OK</label>
              <label><input type="radio" name="scotch" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="scotch">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="scotch">
              <label>Description</label>
              <textarea data-commentfor="scotch" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Les livres ont-ils bien √©t√© d√©poussi√©r√©s ?</label>
            <div class="okko">
              <label><input type="radio" name="depoussierage" value="OK"> OK</label>
              <label><input type="radio" name="depoussierage" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="depoussierage">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="depoussierage">
              <label>Description</label>
              <textarea data-commentfor="depoussierage" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>
        </div>

        <button class="btn" type="submit" style="width:100%">Enregistrer</button>
        <div class="result"></div>
        <p style="color:var(--muted)">R√®gle : toute <strong>KO</strong> ‚áí photo + commentaire obligatoires.</p>
      </form>
    </section>

    <!-- ==================== PALETTES AVANT ==================== -->
    <section id="tab-palettes-avant" class="tab-pane">
      <h2>Contr√¥le ‚Äî Palettes (Avant)</h2>
      <form class="qc-form" data-type="Palettes_Avant">
        <div class="card grid-2">
          <div>
            <label>Date du contr√¥le</label>
            <input type="date" name="date_jour" required>
          </div>
          <div>
            <label>Photo principale (palette)</label>
            <input type="file" id="pa_photo_cam" accept="image/*" capture="environment" style="display:none">
            <input type="file" id="pa_photo_gal" accept="image/*" style="display:none">
            <input type="file" name="photo_principale" id="pa_photo_target" accept="image/*" style="display:none">
            <div class="row">
              <button type="button" class="btn" id="btnPaPhotoCam">üì∑ Prendre photo</button>
              <button type="button" class="btn secondary" id="btnPaPhotoGal">üñºÔ∏è Galerie</button>
              <span id="pa_photo_label" style="margin-left:8px;color:var(--muted)"></span>
            </div>
          </div>
        </div>

        <div class="card">
          <label>D√©coder un code-barres palette (photo)</label>
          <input type="file" id="pa_bc_cam" accept="image/*" capture="environment" style="display:none">
          <input type="file" id="pa_bc_gal" accept="image/*" style="display:none">
          <input type="file" accept="image/*" id="pa_barcode_file" style="display:none">
          <div class="row">
            <button type="button" class="btn" id="btnPaBcCam">üì∑ Prendre photo</button>
            <button type="button" class="btn secondary" id="btnPaBcGal">üñºÔ∏è Galerie</button>
            <button type="button" class="btn" data-action="decode" data-target="pa_barcode_file" data-out="pa_code_barres">D√©coder</button>
            <span id="pa_bc_label" style="margin-left:8px;color:var(--muted)"></span>
          </div>
          <input type="text" name="code_barres" id="pa_code_barres" placeholder="Code-barres palette" required>
        </div>

        <div class="card">
          <h3>Contr√¥les</h3>

          <div class="card">
            <label>Les cartons sont-ils en bon √©tat ?</label>
            <div class="okko">
              <label><input type="radio" name="cartons_etat" value="OK"> OK</label>
              <label><input type="radio" name="cartons_etat" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="cartons_etat">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="cartons_etat">
              <label>Description</label>
              <textarea data-commentfor="cartons_etat" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Y a-t-il des intercalaires pour s√©parer les cartons ?</label>
            <div class="okko">
              <label><input type="radio" name="intercalaires_cartons" value="OK"> OK</label>
              <label><input type="radio" name="intercalaires_cartons" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="intercalaires_cartons">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="intercalaires_cartons">
              <label>Description</label>
              <textarea data-commentfor="intercalaires_cartons" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>L‚Äôordre des cartons et la disposition sont-ils respect√©s ?</label>
            <div class="okko">
              <label><input type="radio" name="ordre_cartons" value="OK"> OK</label>
              <label><input type="radio" name="ordre_cartons" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="ordre_cartons">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="ordre_cartons">
              <label>Description</label>
              <textarea data-commentfor="ordre_cartons" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Le cerclage est-il bien appliqu√© ?</label>
            <div class="okko">
              <label><input type="radio" name="cerclage" value="OK"> OK</label>
              <label><input type="radio" name="cerclage" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="cerclage">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="cerclage">
              <label>Description</label>
              <textarea data-commentfor="cerclage" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>La palette est-elle stable ?</label>
            <div class="okko">
              <label><input type="radio" name="stabilite" value="OK"> OK</label>
              <label><input type="radio" name="stabilite" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="stabilite">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="stabilite">
              <label>Description</label>
              <textarea data-commentfor="stabilite" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>
        </div>

        <button class="btn" type="submit" style="width:100%">Enregistrer</button>
        <div class="result"></div>
        <p style="color:var(--muted)">R√®gle : toute <strong>KO</strong> ‚áí photo + commentaire obligatoires.</p>
      </form>
    </section>

    <!-- ==================== PALETTES DESTINATION ==================== -->
    <section id="tab-palettes-destination" class="tab-pane">
      <h2>Contr√¥le ‚Äî Palettes (Destination)</h2>
      <form class="qc-form" data-type="Palettes_Destination">
        <div class="card grid-2">
          <div>
            <label>Date du contr√¥le</label>
            <input type="date" name="date_jour" required>
          </div>
          <div>
            <label>Photo principale (palette)</label>
            <input type="file" id="pd_photo_cam" accept="image/*" capture="environment" style="display:none">
            <input type="file" id="pd_photo_gal" accept="image/*" style="display:none">
            <input type="file" name="photo_principale" id="pd_photo_target" accept="image/*" style="display:none">
            <div class="row">
              <button type="button" class="btn" id="btnPdPhotoCam">üì∑ Prendre photo</button>
              <button type="button" class="btn secondary" id="btnPdPhotoGal">üñºÔ∏è Galerie</button>
              <span id="pd_photo_label" style="margin-left:8px;color:var(--muted)"></span>
            </div>
          </div>
        </div>

        <div class="card">
          <label>D√©coder un code-barres (photo)</label>
          <input type="file" id="pd_bc_cam" accept="image/*" capture="environment" style="display:none">
          <input type="file" id="pd_bc_gal" accept="image/*" style="display:none">
          <input type="file" accept="image/*" id="pd_barcode_file" style="display:none">
          <div class="row">
            <button type="button" class="btn" id="btnPdBcCam">üì∑ Prendre photo</button>
            <button type="button" class="btn secondary" id="btnPdBcGal">üñºÔ∏è Galerie</button>
            <button type="button" class="btn" data-action="decode" data-target="pd_barcode_file" data-out="pd_code_barres">D√©coder</button>
            <span id="pd_bc_label" style="margin-left:8px;color:var(--muted)"></span>
          </div>
          <input type="text" name="code_barres" id="pd_code_barres" placeholder="Code-barres" required>
        </div>

        <div class="card">
          <h3>Contr√¥les</h3>

          <div class="card">
            <label>Les cartons sont-ils en bon √©tat ?</label>
            <div class="okko">
              <label><input type="radio" name="cartons_etat" value="OK"> OK</label>
              <label><input type="radio" name="cartons_etat" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="cartons_etat">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="cartons_etat">
              <label>Description</label>
              <textarea data-commentfor="cartons_etat" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <div class="card">
            <label>Le cerclage est-il bien appliqu√© ?</label>
            <div class="okko">
              <label><input type="radio" name="cerclage" value="OK"> OK</label>
              <label><input type="radio" name="cerclage" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="cerclage">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="cerclage">
              <label>Description</label>
              <textarea data-commentfor="cerclage" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>
        </div>

        <button class="btn" type="submit" style="width:100%">Enregistrer</button>
        <div class="result"></div>
        <p style="color:var(--muted)">R√®gle : toute <strong>KO</strong> ‚áí photo + commentaire obligatoires.</p>
      </form>
    </section>

    <!-- ==================== KPI ==================== -->
    <section id="tab-kpi" class="tab-pane">
      <h2>Tableau de bord KPI</h2>
      <div class="row">
        <label for="kpi_from">Du :</label><input type="date" id="kpi_from">
        <label for="kpi_to">au :</label><input type="date" id="kpi_to">
        <button class="btn" id="btnKpi">Afficher</button>
        <button class="btn secondary" id="btnExport">Export Excel</button>
      </div>
      <div id="kpiResults" class="kpi-wrap"></div>
    </section>
  </main>

  <footer class="center" style="margin:40px 0; font-size:14px; color:var(--muted)">
    ¬© Pelichet ‚Äî QC
  </footer>

  <!-- Librairies + App -->
  <script src="https://unpkg.com/@zxing/browser@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
  <script src="app.js"></script>

  <!-- Script inline : branche les paires Cam√©ra/Galerie -> champ cible -->
  <script>
  (function(){
    function copyToTarget(srcInput, targetInput, labelEl){
      if (!srcInput.files || !srcInput.files[0]) return;
      const dt = new DataTransfer();
      dt.items.add(srcInput.files[0]);
      targetInput.files = dt.files;
      if (labelEl) labelEl.textContent = srcInput.files[0].name;
    }
    function hookPair(btnCamId, camId, btnGalId, galId, targetId, labelId){
      const btnCam = document.getElementById(btnCamId);
      const cam = document.getElementById(camId);
      const btnGal = document.getElementById(btnGalId);
      const gal = document.getElementById(galId);
      const tgt = document.getElementById(targetId);
      const label = document.getElementById(labelId);
      if (btnCam && cam) btnCam.addEventListener('click', ()=> cam.click());
      if (btnGal && gal) btnGal.addEventListener('click', ()=> gal.click());
      if (cam && tgt) cam.addEventListener('change', ()=> copyToTarget(cam, tgt, label));
      if (gal && tgt) gal.addEventListener('change', ()=> copyToTarget(gal, tgt, label));
    }

    document.addEventListener('DOMContentLoaded', function(){
      // Cartons - photo principale
      hookPair('btnCartonsPhotoCam','cartons_photo_cam','btnCartonsPhotoGal','cartons_photo_gal','cartons_photo_target','cartons_photo_label');
      // Cartons - code-barres
      hookPair('btnCartonsBcCam','cartons_bc_cam','btnCartonsBcGal','cartons_bc_gal','cartons_barcode_file','cartons_bc_label');

      // Palettes Avant - photo principale
      hookPair('btnPaPhotoCam','pa_photo_cam','btnPaPhotoGal','pa_photo_gal','pa_photo_target','pa_photo_label');
      // Palettes Avant - code-barres
      hookPair('btnPaBcCam','pa_bc_cam','btnPaBcGal','pa_bc_gal','pa_barcode_file','pa_bc_label');

      // Palettes Destination - photo principale
      hookPair('btnPdPhotoCam','pd_photo_cam','btnPdPhotoGal','pd_photo_gal','pd_photo_target','pd_photo_label');
      // Palettes Destination - code-barres
      hookPair('btnPdBcCam','pd_bc_cam','btnPdBcGal','pd_bc_gal','pd_barcode_file','pd_bc_label');
    });
  })();
  </script>
</body>
</html>
