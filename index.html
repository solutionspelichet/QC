<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#FF6A00" />
  <title>Pelichet QC</title>

  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" type="image/png" sizes="16x16" href="icon-16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icon-32.png">
  <link rel="apple-touch-icon" href="icon-180.png">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <header class="app-header">
    <div class="brand">
      <img src="logo-pelichet.svg" alt="Pelichet QC" class="logo">
    </div>
    <nav class="tabs">
      <button class="tab active" data-tab="cartons">Cartons</button>
      <button class="tab" data-tab="palettes-avant">Palettes Avant</button>
      <button class="tab" data-tab="palettes-destination">Palettes Destination</button>
      <button class="tab" data-tab="kpi">KPI</button>
    </nav>
    <div class="actions">
      <button id="toggleTheme" class="icon-btn" title="Th√®me clair/sombre">üåì</button>
    </div>
  </header>

  <main class="container">
    <!-- ============== CARTONS ============== -->
    <section id="tab-cartons" class="tab-pane active">
      <h2>Contr√¥le ‚Äî Cartons</h2>
      <form class="qc-form" data-type="Cartons">
        <div class="card grid-2">
          <div>
            <label>Date du contr√¥le</label>
            <input type="date" name="date_jour" required>
          </div>
          <div>
            <label>Photo principale (carton)</label>
            <input type="file" accept="image/*" name="photo_principale">
          </div>
        </div>

        <div class="card">
  <label>Photo principale</label>
  <div class="row">
    <!-- Fichier "cam√©ra" (non visible) -->
    <input type="file" id="photo_main_camera" accept="image/*" capture="environment" style="display:none">
    <!-- Fichier "galerie" (non visible) -->
    <input type="file" id="photo_main_gallery" accept="image/*" style="display:none">
    <!-- Champ cible (reste inchang√© pour ton code existant) -->
    <input type="file" name="photo_principale" id="photo_principale" accept="image/*" style="display:none">

    <button type="button" class="btn" id="btnPhotoMainCam">üì∑ Prendre photo</button>
    <button type="button" class="btn secondary" id="btnPhotoMainGal">üñºÔ∏è Depuis la galerie</button>
    <span id="photo_main_filename" style="margin-left:8px;color:var(--muted)"></span>
  </div>
</div>


        <div class="card">
          <label>D√©coder un code-barres (photo)</label>
          <div class="row">
            <input type="file" accept="image/*" id="cartons_barcode_file">
            <button type="button" class="btn" data-action="decode" data-target="cartons_barcode_file" data-out="cartons_code_barres">D√©coder</button>
          </div>
          <input type="text" name="code_barres" id="cartons_code_barres" placeholder="Code-barres" required>
        </div>

        <div class="card">
          <h3>Contr√¥les</h3>
<div class="card">
  <label>Photo code barre</label>
  <div class="row">
    <!-- Fichier "cam√©ra" (non visible) -->
    <input type="file" id="photo_main_camera" accept="image/*" capture="environment" style="display:none">
    <!-- Fichier "galerie" (non visible) -->
    <input type="file" id="photo_main_gallery" accept="image/*" style="display:none">
    <!-- Champ cible (reste inchang√© pour ton code existant) -->
    <input type="file" name="photo_principale" id="photo_principale" accept="image/*" style="display:none">

    <button type="button" class="btn" id="btnPhotoMainCam">üì∑ Prendre photo</button>
    <button type="button" class="btn secondary" id="btnPhotoMainGal">üñºÔ∏è Depuis la galerie</button>
    <span id="photo_main_filename" style="margin-left:8px;color:var(--muted)"></span>
  </div>
</div>

          <!-- 1 -->
          <div class="card">
            <label>Le calage papier est-il bien fait ?</label>
            <div class="okko">
              <label><input type="radio" name="callage_papier" value="OK"> OK</label>
              <label><input type="radio" name="callage_papier" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="callage_papier">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="callage_papier">
              <label>Description</label>
              <textarea data-commentfor="callage_papier" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <!-- 2 -->
          <div class="card">
            <label>Y a-t-il des intercalaires pour s√©parer les colonnes de livres ?</label>
            <div class="okko">
              <label><input type="radio" name="intercalaires_livres" value="OK"> OK</label>
              <label><input type="radio" name="intercalaires_livres" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="intercalaires_livres">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="intercalaires_livres">
              <label>Description</label>
              <textarea data-commentfor="intercalaires_livres" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <!-- 3 -->
          <div class="card">
            <label>L‚Äôordre des colonnes et la disposition sont-ils respect√©s ?</label>
            <div class="okko">
              <label><input type="radio" name="ordre_colonnes" value="OK"> OK</label>
              <label><input type="radio" name="ordre_colonnes" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="ordre_colonnes">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="ordre_colonnes">
              <label>Description</label>
              <textarea data-commentfor="ordre_colonnes" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <!-- 4 -->
          <div class="card">
            <label>Le scotch est-il bien appliqu√© ?</label>
            <div class="okko">
              <label><input type="radio" name="scotch" value="OK"> OK</label>
              <label><input type="radio" name="scotch" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="scotch">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="scotch">
              <label>Description</label>
              <textarea data-commentfor="scotch" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <!-- 5 -->
          <div class="card">
            <label>Les livres ont-ils bien √©t√© d√©poussi√©r√©s ?</label>
            <div class="okko">
              <label><input type="radio" name="depoussierage" value="OK"> OK</label>
              <label><input type="radio" name="depoussierage" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="depoussierage">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="depoussierage">
              <label>Description</label>
              <textarea data-commentfor="depoussierage" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>
        </div>

        <button class="btn" type="submit" style="width:100%">Enregistrer</button>
        <div class="result"></div>
        <p style="color:var(--muted)">R√®gle : toute <strong>KO</strong> ‚áí photo + commentaire obligatoires.</p>
      </form>
    </section>

    <!-- ============== PALETTES AVANT ============== -->
    <section id="tab-palettes-avant" class="tab-pane">
      <h2>Contr√¥le ‚Äî Palettes (Avant)</h2>
      <form class="qc-form" data-type="Palettes_Avant">
        <div class="card grid-2">
          <div>
            <label>Date du contr√¥le</label>
            <input type="date" name="date_jour" required>
          </div>
          <div>
            <label>Photo principale (palette)</label>
            <input type="file" accept="image/*" name="photo_principale">
          </div>
        </div>

        <div class="card">
          <label>D√©coder un code-barres palette (photo)</label>
          <div class="row">
            <input type="file" accept="image/*" id="pa_barcode_file">
            <button type="button" class="btn" data-action="decode" data-target="pa_barcode_file" data-out="pa_code_barres">D√©coder</button>
          </div>
          <input type="text" name="code_barres" id="pa_code_barres" placeholder="Code-barres palette" required>
        </div>

        <div class="card">
          <h3>Contr√¥les</h3>

          <!-- 1 -->
          <div class="card">
            <label>Les cartons sont-ils en bon √©tat ?</label>
            <div class="okko">
              <label><input type="radio" name="cartons_etat" value="OK"> OK</label>
              <label><input type="radio" name="cartons_etat" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="cartons_etat">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="cartons_etat">
              <label>Description</label>
              <textarea data-commentfor="cartons_etat" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <!-- 2 -->
          <div class="card">
            <label>Y a-t-il des intercalaires pour s√©parer les cartons ?</label>
            <div class="okko">
              <label><input type="radio" name="intercalaires_cartons" value="OK"> OK</label>
              <label><input type="radio" name="intercalaires_cartons" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="intercalaires_cartons">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="intercalaires_cartons">
              <label>Description</label>
              <textarea data-commentfor="intercalaires_cartons" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <!-- 3 -->
          <div class="card">
            <label>L‚Äôordre des cartons et la disposition sont-ils respect√©s ?</label>
            <div class="okko">
              <label><input type="radio" name="ordre_cartons" value="OK"> OK</label>
              <label><input type="radio" name="ordre_cartons" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="ordre_cartons">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="ordre_cartons">
              <label>Description</label>
              <textarea data-commentfor="ordre_cartons" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <!-- 4 -->
          <div class="card">
            <label>Le cerclage est-il bien appliqu√© ?</label>
            <div class="okko">
              <label><input type="radio" name="cerclage" value="OK"> OK</label>
              <label><input type="radio" name="cerclage" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="cerclage">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="cerclage">
              <label>Description</label>
              <textarea data-commentfor="cerclage" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <!-- 5 -->
          <div class="card">
            <label>La palette est-elle stable ?</label>
            <div class="okko">
              <label><input type="radio" name="stabilite" value="OK"> OK</label>
              <label><input type="radio" name="stabilite" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="stabilite">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="stabilite">
              <label>Description</label>
              <textarea data-commentfor="stabilite" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>
        </div>

        <button class="btn" type="submit" style="width:100%">Enregistrer</button>
        <div class="result"></div>
        <p style="color:var(--muted)">R√®gle : toute <strong>KO</strong> ‚áí photo + commentaire obligatoires.</p>
      </form>
    </section>

    <!-- ============== PALETTES DESTINATION ============== -->
    <section id="tab-palettes-destination" class="tab-pane">
      <h2>Contr√¥le ‚Äî Palettes (Destination)</h2>
      <form class="qc-form" data-type="Palettes_Destination">
        <div class="card grid-2">
          <div>
            <label>Date du contr√¥le</label>
            <input type="date" name="date_jour" required>
          </div>
          <div>
            <label>Photo principale (palette)</label>
            <input type="file" accept="image/*" name="photo_principale">
          </div>
        </div>

        <div class="card">
          <label>D√©coder un code-barres (photo)</label>
          <div class="row">
            <input type="file" accept="image/*" id="pd_barcode_file">
            <button type="button" class="btn" data-action="decode" data-target="pd_barcode_file" data-out="pd_code_barres">D√©coder</button>
          </div>
          <input type="text" name="code_barres" id="pd_code_barres" placeholder="Code-barres" required>
        </div>

        <div class="card">
          <h3>Contr√¥les</h3>

          <!-- 1 -->
          <div class="card">
            <label>Les cartons sont-ils en bon √©tat ?</label>
            <div class="okko">
              <label><input type="radio" name="cartons_etat" value="OK"> OK</label>
              <label><input type="radio" name="cartons_etat" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="cartons_etat">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="cartons_etat">
              <label>Description</label>
              <textarea data-commentfor="cartons_etat" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>

          <!-- 2 -->
          <div class="card">
            <label>Le cerclage est-il bien appliqu√© ?</label>
            <div class="okko">
              <label><input type="radio" name="cerclage" value="OK"> OK</label>
              <label><input type="radio" name="cerclage" value="KO"> KO</label>
            </div>
            <div class="ko-extra" data-for="cerclage">
              <label>Photo du probl√®me</label>
              <input type="file" accept="image/*" data-photofor="cerclage">
              <label>Description</label>
              <textarea data-commentfor="cerclage" placeholder="D√©crivez le probl√®me‚Ä¶"></textarea>
            </div>
          </div>
        </div>

        <button class="btn" type="submit" style="width:100%">Enregistrer</button>
        <div class="result"></div>
        <p style="color:var(--muted)">R√®gle : toute <strong>KO</strong> ‚áí photo + commentaire obligatoires.</p>
      </form>
    </section>

    <!-- ============== KPI ============== -->
    <section id="tab-kpi" class="tab-pane">
      <h2>Tableau de bord KPI</h2>
      <div class="row">
        <label for="kpi_from">Du :</label><input type="date" id="kpi_from">
        <label for="kpi_to">au :</label><input type="date" id="kpi_to">
        <button class="btn" id="btnKpi">Afficher</button>
        <button class="btn secondary" id="btnExport">Export Excel</button>
      </div>
      <div id="kpiResults" class="kpi-wrap"></div>
    </section>
  </main>

  <footer class="center" style="margin:40px 0; font-size:14px; color:var(--muted)">
    ¬© Pelichet ‚Äî QC
  </footer>

  <script src="https://unpkg.com/@zxing/browser@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
